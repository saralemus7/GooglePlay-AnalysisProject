---
title: "Understanding Google Play Application Reviews"
author: "RTime2Shine"
date: "12/7/19"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r load-packages, warning = FALSE, message=FALSE}
library(tidyverse)
library(broom)
library(knitr) 
library(skimr)
library(readr)
library(ggplot2)
library(stringr)
library(lubridate)
library(Sleuth3) 
library(ISLR)
library(leaps)
library(dplyr)
library(rms)
```

## Section 1: Introduction (includes introduction and exploratory data analysis)
### Motivaton

As technology has become increasingly prevalent around the world, there has been a change in the consumption of media. One of these ways is via the purchase of applications (apps) for various smartphones and other devices. Several technology companies, including Apple and Google, run virtual stores for these apps in which a person can download an app for their device. These apps can be for various purposes like socializing, playing games, or watching television and movies, among others. While any user of a phone can agree that apps hold an important effect on how one interacts with technology on a daily basis, the weight of the impact becomes even more shocking when one looks at the figures- in 2018, global app downloads topped 194 billion (Dignan).

Our motivation for this project is to understand what makes apps (from the Google Play store specifically) have favorable ratings. Understanding the ratings of an app is important for several reasons. First, ratings can be important to the provider- in this case Google- who can decide whether an app should continue to be sold to maintain their quality standards. Ratings are additionally useful as a direct line of communication between the user and the developers- often, developers are made aware of changes that need to be made to their apps through user feedback. Lastly, reviews serve to inform potential users of an app whether or not it is worth their time and can affect future downloads. Considering that app users are predicted to spend about $120 billion in app stores in 2019, understanding which apps do well on the Play Store and what factors affect app performance is an immensely important question to gain more insight into. 

### Research Question & Hypothesis

Our ultimate goal is to create a model which most accurately and concisely predicts the Rating of an app given the predictors in the dataset. This will enable us to see which predictor variables interact with each other to effect the rating for a given app. We posit that examining such relationships will help developers understand what factors may influence an app's rating and use that information to create better applications for consumers. As well, conglomerates such as Google (whom this dataset is from) can use this information to more accurately display or promote apps that meet these characteristics or promote ads related to these apps and generate revenue. 

This leads us to introduce our main research question: What are the relevant factors that affect the rating given for apps in the Google Play store? Although this project will give a detailed attempt to answer this question, our preliminary hypothesis is that the variables Category, Price, Installs, and Content Rating are the predictor variables that will most affect a given app rating and popularity, as measured by the number of installs of the app. We believe that these variables are indicative of an apps useability and likeness (as determined by variables like content rating and categories in how people may be drawn to an app) as well as its accessibility (price). Furthermore, once we test our hypothesis and determine which factors are relevant, we will attempt to use that information to predict the success of an app as measured by its rating.

### The Data

The dataset was obtained from Kaggle. According to Kaggle, the dataset was scraped directly from the Google Play Store in August 2018. Each observation represents one individual app on the Google Play Store. This particular dataset has 13 variables with 10841 observations. The variables consist of various information collected about each application (which represents a row) in the dataset. This information includes the apps category in the app store, its average rating, price, content rating, the number of installs, among other metrics. In our Exploratory Data Analysis, we will further explain the use of each of these variables and determine which of these may be significant for and relevant in our analysis. The response variable in our investigation is `Rating` which is the mean rating out of 5.0 for an application in the Google Play Store. This is a numeric variable. 

### Exploratory Data Analysis

```{r load-data, warning = FALSE, message=FALSE}
apps <- read_csv("/cloud/project/02-data/googleplaystore.csv")
skim(apps)
levels(apps$`Content Rating`) <- c("Adults Only","Everyone","Mature", "Teen", "Unrated")
apps <- filter(apps, Reviews <= 203579)
apps$`Rating` <- as.numeric(apps$`Rating`)
apps <- apps %>%
  na.omit(apps)
```

```{r fact recode, warning = FALSE, message = FALSE}
apps <- apps %>%
  mutate(Category = as.factor(Category)) %>%
  mutate(Size = as.factor(Size)) %>%
  mutate(Installs = as.factor(Installs)) %>%
  mutate(Type = as.factor(Type)) %>%
  mutate(`Content Rating` = as.factor(`Content Rating`)) %>%
  mutate(Genres = as.factor(Genres)) %>%
  mutate(Category = as.factor(Category))

apps$Price <- str_replace(apps$Price, "\\$", "")
apps$Size <- str_replace(apps$Size, "\\M", "")
apps$Installs <- str_replace(apps$Installs, "\\+", "")
apps$`Content Rating`<- str_replace(apps$`Content Rating`, "\\+", "")
apps$`Content Rating`<- str_replace(apps$`Content Rating`, "[[:digit:]]+", "")
apps$Price <- as.numeric(gsub('[$.]', '', apps$Price))
apps$`Android Ver`<-gsub("\\..*","",apps$`Android Ver`)
apps$`Android Ver`<-as.factor(apps$`Android Ver`)
apps$`Android Ver`[apps$`Android Ver` == "NaN"] <- NA
```

#### Data Wrangling

Upon examining our predictor variables, it looks like there are occasionally one or two observations missing in the dataset, which does not raise lots of concern. It is worth noting, however, that 1474 of our response variable values are missing. This is roughly 10% of the data. Given that the data was web scraped, we will assume that the reason behind these missing values is that there was not a mean rating value for those particular observations (app). Thus, we will omit all of the NA values and continue to investigate only those apps for which we have ratings. 

Furthermore, here it is worth noting that the variable, `Genres` contains the same information in the `category` variable - the only difference being that the data is just displayed a bit differently. Therefore, as to avoid being redundant, we will only be using `category` in our analysis. As well, the information contained in the variable `Type` is also contained in `Price`. Since `Price` provides the prices of an app and `Type` simply denotes wether or not an app is paid or free. There is mostly likely a large linear dependency between these two variables as they measure the same thing, so we will use `Price` instead of `Type.` We will not deleting theese variables from the dataset as to maintain integrity, but will not examine them in our analysis.

As well, we also have many of predictors that are coded as characters in the dataset, so we decided to recode them as factors. We also have some variables that are coded as characters due to the existence of a particular a symbol (ex. $), we will recoded these into a format which will be usable for our analysis. 

Looking at the data, there are two variables related to the version, or iteration of the app as provided by the developers: `Current Ver` and `Android Ver`. Given that Google owns both Android and the Google Play Store, the company would likely be more interested in the Android version of the app. Furthermore, Android users are unlikely to be using other operating system's application stores, so a developer who is interested in creating apps for the Android market would gain more information through an examination of the compatibility of certain apps with a particular version of Android. Some data wrangling was necessary to make this variable suitable for analysis.

We also created a variable called `date_since`, which marks the number of days that the app has been updated since the day that the data was scraped on August 8, 2018. This will allow us to determine how recent the last update was for a particular app and provides some information related to the relative frequency of updates and how that may affect an app's rating.

```{r dates, warning = FALSE, message = FALSE}
apps <- apps %>%
  mutate(date_new = mdy(`Last Updated`))
apps <- apps %>%
  mutate(date_since = mdy("August 8, 2018") - date_new)
```

There are also a number of variables which required releveling. Many of our predictors have multiple levels and these may have made our model too complicated. To reduce the probabiltiy that the model overfits the data and is too complicated, we will relevel our variables as follows:

Since our variable `Price` is currently not numeric and isn't coded into categories, we will relevel price into 3 categories: Free, Between 0 and 4.99 dollars, and greater than 5 dollars. 

```{r price-relevel, warning = FALSE, message = FALSE}
apps <- apps %>%
  mutate(Price = case_when(Price == 0 ~ "Free", Price < 500 & Price > 0 ~ "Between $0 and $4.99", Price > 500 ~ "Greater than $5"))

apps <- apps %>%
  mutate(Price = fct_relevel(Price, "Free", "Between $0 and $4.99", "Greater than $5"))
```

Since our variable `Size` is currently very widely distributed, we will relevel size into 3 categories: Varies with Device, Less than 100, and Greater than 100.

```{r sizerelevel, warning = FALSE, message = FALSE}
apps$`Size`<- sub('k$', '', apps$`Size`)
apps$`Size`<- as.numeric(gsub("Varies with device", 0.001 , apps$`Size`))
apps <- apps %>%
  mutate(Size = case_when(Size == 0.001 ~ "Varies with device", Size < 100 ~ "Less than 100 MB", Size > 100 ~ "Greater than 100 MB"))
```

Since our variable `Installs` is currently very widely distributed, we will relevel installs into 3 categories: Less than 100, Between 100 and 1,000, Between 1,000 and 10,000, Between 10,000 and 100,000, and 100,000 or Greater.

```{r installs-relevel, warning = FALSE, message = FALSE}
apps$`Installs`<- as.numeric(gsub(",", "", apps$`Installs`))

apps <- apps %>%
  mutate(Installs = case_when(Installs < 100 ~ "Less than 100", Installs < 1000 & Installs >= 100 ~ "Between 100 and 1,000", Installs < 10000 & Installs >= 1000 ~ "Between 1,000 and 10,000", Installs < 100000 & Installs >= 10000 ~ "Between 10,000 and 100,000", Installs >= 100000 ~ "100,000 or Greater"))


apps <- apps %>%
  mutate(Installs = fct_relevel(Installs, "Less than 100", "Between 100 and 1,000", "Between 1,000 and 10,000", "Between 10,000 and 100,000", "100,000 or Greater"))

```

Our variable `Category` is extremely large and has many levels as shown in the graphiic below. To simplify this, we will create a new variable called `category_simp` with two levels: one for the top 6 categories ("FAMILY","GAME", "TOOLS","MEDICAL", "LIFESTYLE", and "FINANCE") and another for all the other categories. 

```{r category pop, warning = FALSE, message = FALSE}
apps %>%
  count(Category) %>%
  arrange(-n) %>%
  mutate(freq = n/sum(n))
```

```{r relevel cat, warning = FALSE, message = FALSE}
apps <- apps %>%
  mutate(category_simp = case_when( 
    apps$Category %in% c("FAMILY","GAME", "TOOLS","MEDICAL", "LIFESTYLE", "FINANCE") ~ "Top 6 Categories", 
    TRUE ~ "Others"))

apps %>%
  count(Category, category_simp) %>%
  arrange(desc(n))
```

As shown in the above table, we can see that the top 6 cateogies are in one level and the others are stored in another level. 

```{r relevel andriod ver}
apps %>%
  count(`Android Ver`) %>%
  arrange(desc(n))

apps <- apps %>%
  na.omit(`Android Ver`) %>%
  mutate(androidver_simp = case_when( 
    `Android Ver` %in% c(1,2,3,4) ~ "1-4", 
    `Android Ver` %in% c(5,6,7,8) ~ "5-8",
    TRUE ~ "Varies with Device"))

apps %>%
  count(`Android Ver`, androidver_simp) %>%
  arrange(desc(n))
```

Android Ver


```{r}
apps <- apps %>%
  mutate(content_simp = case_when( 
    `Content Rating` == "Everyone" ~ "Everyone",
    `Content Rating` == "Teen" ~ "Teen",
    `Content Rating` == "Mature" ~ "Mature",
    `Content Rating` == "Everyone" ~ "Everyone",
    `Content Rating` == "Adults only" ~ "Adults only",
    `Content Rating` == "Unrated" ~ "Unrated"))
apps %>%
  count(`Content Rating`, content_simp) %>%
  arrange(desc(n))
```

Content rating

#### Univariate Analysis

```{r rating-distribution, warning = FALSE, message = FALSE}
ggplot(data = apps, aes(x = Rating)) + 
  geom_histogram(binwidth = 0.1, fill = "blue") + 
  xlim(0,5) + labs(title = "Distribution of App Ratings")
```
response

```{r log reviews, warning = FALSE, message = FALSE}
apps <- apps %>% 
  mutate(log_reviews = log(Reviews)) 
ggplot(apps, aes(x = log_reviews)) + geom_histogram(binwidth = 0.5)
apps %>%
  summarise(median(log_reviews), max(log_reviews), IQR(log_reviews))
```

log reviews explain why
#### Bivariate Analysis

#### Possible Interactions

## Section 2: Regression Analysis (includes the final model and discussion of assumptions)

### Model Process
### Model Selection

```{r full-model}
apps <- apps %>%
  na.omit(apps)
full_model <- lm(Rating ~ category_simp + log_reviews + Size + Installs + Price + `Content Rating` + androidver_simp + date_since, data = apps)
kable(tidy(full_model),format="html",digits=4)
```

```{r bic-back}
regfit_backward <- regsubsets(Rating ~ category_simp + log_reviews + Size + Installs + Price + `Content Rating` + androidver_simp + date_since, data = apps, method="backward")
sel_summary <- summary(regfit_backward)
coef(regfit_backward, which.min(sel_summary$bic))
```

```{r bic-forward}
regfit_forward <- regsubsets(Rating ~ category_simp + log_reviews + Size + Installs + Price + `Content Rating` + androidver_simp + date_since, data = apps, method="forward")
sel_summary <- summary(regfit_forward)
coef(regfit_forward, which.min(sel_summary$bic))
```

### Interactions & Our Updated Model
### Assumptions
### Model Assesment
### Model Interpretation

## Section 3: Discussion and Limitations 

## Section 4: Conclusion

## Section 5: Additional Work

### References

Gupta, Lavanya. Kaggle. Jan. 2019, www.kaggle.com/lava18/google-play-store-apps?fbclid=IwAR36EMS2jg5fhPi-BQlX6Mv4MCk8YUm2XmyOLt0zsKkNyc9JK-JD7aLy-6I. Accessed 30 Oct. 2019. 

Dignan, Larry. “App Economy Expected to Be $120 Billion in 2019 as Small Screen Leads Digital Transformation Efforts.” ZDNet, ZDNet, 16 Jan. 2019, www.zdnet.com/article/app-economy-expected-to-be-120-billion-in-2019-as-small-screen-leads-digital-transformation-efforts/
