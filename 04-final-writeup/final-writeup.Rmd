---
title: "Understanding Google Play Application Reviews"
author: "RTime2Shine"
date: "12/7/19"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r load-packages, warning = FALSE, message=FALSE}
library(tidyverse)
library(broom)
library(knitr) 
library(skimr)
library(readr)
library(ggplot2)
library(stringr)
library(lubridate)
library(Sleuth3) 
library(ISLR)
library(leaps)
library(dplyr)
library(rms)
```

```{r load-data, warning = FALSE, message=FALSE}
apps <- read_csv("/cloud/project/02-data/googleplaystore.csv")
levels(apps$`Content Rating`) <- c("Adults Only","Everyone","Mature", "Teen", "Unrated")
apps <- filter(apps, Reviews <= 203579)
apps$`Rating` <- as.numeric(apps$`Rating`)
apps <- apps %>%
  na.omit(apps)
```

```{r fact recode, warning = FALSE, message = FALSE}
apps <- apps %>%
  mutate(Category = as.factor(Category)) %>%
  mutate(Size = as.factor(Size)) %>%
  mutate(Installs = as.factor(Installs)) %>%
  mutate(Type = as.factor(Type)) %>%
  mutate(`Content Rating` = as.factor(`Content Rating`)) %>%
  mutate(Genres = as.factor(Genres)) %>%
  mutate(Category = as.factor(Category))

apps$Price <- str_replace(apps$Price, "\\$", "")
apps$Size <- str_replace(apps$Size, "\\M", "")
apps$Installs <- str_replace(apps$Installs, "\\+", "")
apps$`Content Rating`<- str_replace(apps$`Content Rating`, "\\+", "")
apps$`Content Rating`<- str_replace(apps$`Content Rating`, "[[:digit:]]+", "")
apps$Price <- as.numeric(gsub('[$.]', '', apps$Price))
apps$`Android Ver`<-gsub("\\..*","",apps$`Android Ver`)
apps$`Android Ver`<-as.factor(apps$`Android Ver`)
apps$`Android Ver`[apps$`Android Ver` == "NaN"] <- NA
```

```{r dates, warning = FALSE, message = FALSE}
apps <- apps %>%
  mutate(date_new = mdy(`Last Updated`))
apps <- apps %>%
  mutate(date_since = mdy("August 8, 2018") - date_new)
```

```{r price-relevel, warning = FALSE, message = FALSE}
apps <- apps %>%
  mutate(Price = case_when(Price == 0 ~ "Free", Price < 500 & Price > 0 ~ "Between $0 and $4.99", Price > 500 ~ "Greater than $5"))

apps <- apps %>%
  mutate(Price = fct_relevel(Price, "Free", "Between $0 and $4.99", "Greater than $5"))
```

```{r installs-relevel, warning = FALSE, message = FALSE}
apps$`Installs`<- as.numeric(gsub(",", "", apps$`Installs`))

apps <- apps %>%
  mutate(Installs = case_when(Installs < 100 ~ "Less than 100", Installs < 1000 & Installs >= 100 ~ "Between 100 and 1,000", Installs < 10000 & Installs >= 1000 ~ "Between 1,000 and 10,000", Installs < 100000 & Installs >= 10000 ~ "Between 10,000 and 100,000", Installs >= 100000 ~ "100,000 or Greater"))


apps <- apps %>%
  mutate(Installs = fct_relevel(Installs, "Less than 100", "Between 100 and 1,000", "Between 1,000 and 10,000", "Between 10,000 and 100,000", "100,000 or Greater"))

skim(apps, Installs)
```

```{r sizerelevel, warning = FALSE, message = FALSE}
apps$`Size`<- sub('k$', '', apps$`Size`)
apps$`Size`<- as.numeric(gsub("Varies with device", 0.001 , apps$`Size`))
apps <- apps %>%
  mutate(Size = case_when(Size == 0.001 ~ "Varies with device", Size < 100 ~ "Less than 100 MB", Size > 100 ~ "Greater than 100 MB"))

```

```{r rating-distribution, warning = FALSE, message = FALSE}
ggplot(data = apps, aes(x = Rating)) + 
  geom_histogram(binwidth = 0.1, fill = "blue") + 
  xlim(0,5) + labs(title = "Distribution of App Ratings")
```


```{r log reviews, warning = FALSE, message = FALSE}
apps <- apps %>% 
  mutate(log_reviews = log(Reviews)) 
ggplot(apps, aes(x = log_reviews)) + geom_histogram(binwidth = 0.5)
apps %>%
  summarise(median(log_reviews), max(log_reviews), IQR(log_reviews))
```

```{r category pop, warning = FALSE, message = FALSE}
apps %>%
  count(Category) %>%
  arrange(-n) %>%
  mutate(freq = n/sum(n))
```

```{r relevel cat, warning = FALSE, message = FALSE}
apps <- apps %>%
  mutate(category_simp = case_when( 
    apps$Category %in% c("FAMILY","GAME", "TOOLS","MEDICAL", "LIFESTYLE", "FINANCE") ~ "Top 6 Categories", 
    TRUE ~ "Others"))

apps %>%
  count(Category, category_simp) %>%
  arrange(desc(n))
```

```{r relevel andriod ver}
apps %>%
  count(`Android Ver`) %>%
  arrange(desc(n))

apps <- apps %>%
  na.omit(`Android Ver`) %>%
  mutate(androidver_simp = case_when( 
    `Android Ver` %in% c(1,2,3,4) ~ "1-4", 
    `Android Ver` %in% c(5,6,7,8) ~ "5-8",
    TRUE ~ "Varies with Device"))

apps %>%
  count(`Android Ver`, androidver_simp) %>%
  arrange(desc(n))
```

```{r}
apps <- apps %>%
  mutate(content_simp = case_when( 
    `Content Rating` == "Everyone" ~ "Everyone",
    `Content Rating` == "Teen" ~ "Teen",
    `Content Rating` == "Mature" ~ "Mature",
    `Content Rating` == "Everyone" ~ "Everyone",
    `Content Rating` == "Adults only" ~ "Adults only",
    `Content Rating` == "Unrated" ~ "Unrated"))
apps %>%
  count(`Content Rating`, content_simp) %>%
  arrange(desc(n))
```


# Model Selection

```{r full-model}
apps <- apps %>%
  na.omit(apps)
full_model <- lm(Rating ~ category_simp + log_reviews + Size + Installs + Price + `Content Rating` + androidver_simp + date_since, data = apps)
kable(tidy(full_model),format="html",digits=4)
```

```{r vif}
tidy(vif(full_model))
```


```{r bic-back}
regfit_backward <- regsubsets(Rating ~ category_simp + log_reviews + Size + Installs + Price + `Content Rating` + androidver_simp + date_since, data = apps, method="backward")
sel_summary <- summary(regfit_backward)
coef(regfit_backward, which.min(sel_summary$bic))
```

```{r bic-forward}
regfit_forward <- regsubsets(Rating ~ category_simp + log_reviews + Size + Installs + Price + `Content Rating` + androidver_simp + date_since, data = apps, method="forward")
sel_summary <- summary(regfit_forward)
coef(regfit_forward, which.min(sel_summary$bic))
```



## Section 1: Introduction (includes introduction and exploratory data analysis)

Lukengu: relevel categories, log transform and remove the outliers of reviews

Sanjay: finish EDA, etc. 

## Section 2: Regression Analysis (includes the final model and discussion of assumptions)
## Section 3: Discussion and Limitations 
## Section 4: Conclusion
## Section 5: Additional Work